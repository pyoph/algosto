#######################################################
################Directories############################
#######################################################
################à adapter en fonction de votre configuration
##########################################################
simDir <- "D:/Simus/DataSim"
resDir <- "D:/Simus/FitSim"

d <- 10
rList <- 5*(0:10)
load(paste0('SimParmsGrid-n', n,'-d', d,'.Rdata'))
simNb <- 10



#Extraction des paramètres
kList = k1val
lList = l1val
rho1List = rho1val

erreursSigma = array(0,dim = c(length(rList),length(kList),3))
outliers_labelsRec = array(0,dim = c(n,length(rList),length(kList),3))
labels_vraisRec = matrix(0,n,length(rList))


l = 1
rho1 = 0.3

sim = 1

for (i in seq_along(rList) ){
  setwd(simDir)
  
  dataFile <- paste0('SimData-d', d, '-n', n, '-k', k, '-l', 1, '-rho', rho0,'-r',r , '-sim', sim,".RData")
  load(dataFile)
  
  labels_vraisRec[,i] = data$labelsVrais
  r = rList[i]
  
  for (j in seq_along(kList)){
    k = kList[j]
    
    setwd(resDir)
    
    fitFile <- paste0('FitParms-d', d,  '-n', n, '-k', k, '-l', l, '-rho', rho1, '-r',r,'-sim', sim,".RData")
    load(fitFile)
    
    erreursSigma[i,j,1] = norm(Sigma0 - fitNaif$Sigma,"F")
    
    erreursSigma[i,j,2] = norm(Sigma0 - fitUsOnline$Sigma[n,,],"F")
    
    erreursSigma[i,j,3] = norm(Sigma0 - fitUSStreaming$Sigma[n,,],"F")
    
    outliers_labelsRec[,i,j,1] = fitNaif$outliers_labels
    outliers_labelsRec[,i,j,2] = fitUsOnline$outlier_labels
    outliers_labelsRec[,i,j,3] = fitUSStreaming$outlier_labels
    
    
    
  }
  
}


erreursSigma = array(0,dim = c(length(rList),length(kList),3))
outliers_labelsRec = array(0,dim = c(n,length(rList),length(kList),3))
labels_vraisRec = matrix(0,n,length(rList))


k = 0
rho1 = 0.3



erreursSigma = array(0,dim = c(length(rList),length(kList),3))
outliers_labelsRec = array(0,dim = c(n,length(rList),length(kList),3))
labels_vraisRec = matrix(0,n,length(rList))


k = 0
rho1 = 0.3

sim = 1
for (i in seq_along(rList) ){
  setwd(simDir)
  
  dataFile <- paste0('SimData-d', d, '-n', n, '-k', k, '-l', 1, '-rho', rho0,'-r',r , '-sim', sim,".RData")
  load(dataFile)
  
  labels_vraisRec[,i] = data$labelsVrais
  r = rList[i]
  
  for (j in seq_along(lList)[4:length(lList)]){
    l = lList[j]
    
    setwd(resDir)
    
    fitFile <- paste0('FitParms-d', d,  '-n', n, '-k', k, '-l', l, '-rho', rho1, '-r',r,'-sim', sim,".RData")
    load(fitFile)
    
    erreursSigma[i,(j-3),1] = norm(Sigma0 - fitNaif$Sigma,"F")
    
    erreursSigma[i,(j-3),2] = norm(Sigma0 - fitUsOnline$Sigma[n,,],"F")
    
    erreursSigma[i,(j-3),3] = norm(Sigma0 - fitUSStreaming$Sigma[n,,],"F")
    
    outliers_labelsRec[,i,(j-3),1] = fitNaif$outliers_labels
    outliers_labelsRec[,i,(j-3),2] = fitUsOnline$outlier_labels
    outliers_labelsRec[,i,(j-3),3] = fitUSStreaming$outlier_labels
    
    
    
  }
  
}



erreursSigma = array(0,dim = c(length(rList),length(kList),3))
outliers_labelsRec = array(0,dim = c(n,length(rList),length(kList),3))
labels_vraisRec = matrix(0,n,length(rList))





k = 0
rho1 = 0.3

sim = 1
for (i in seq_along(rList) ){
  setwd(simDir)
  
  dataFile <- paste0('SimData-d', d, '-n', n, '-k', k, '-l', 1, '-rho', rho0,'-r',r , '-sim', sim,".RData")
  load(dataFile)
  
  labels_vraisRec[,i] = data$labelsVrais
  r = rList[i]
  setwd(resDir)
  
  for (j in seq_along(l1val)[5:length(l1val)]){
    
    if(j >= 2){
    l = lList[j]
    }
    
    fitFile <- paste0('FitParms-d', d,  '-n', n, '-k', k, '-l', l, '-rho', rho1, '-r',r,'-sim', sim,".RData")
    load(fitFile)
    
    erreursSigma[i,(j-3),1] = norm(Sigma0 - fitNaif$Sigma,"F")
    
    erreursSigma[i,(j-3),2] = norm(Sigma0 - fitUsOnline$Sigma[n,,],"F")
    
    erreursSigma[i,(j-3),3] = norm(Sigma0 - fitUSStreaming$Sigma[n,,],"F")
    
    outliers_labelsRec[,i,(j-3),1] = fitNaif$outliers_labels
    outliers_labelsRec[,i,(j-3),2] = fitUsOnline$outlier_labels
    outliers_labelsRec[,i,(j-3),3] = fitUSStreaming$outlier_labels
    
    
    
  }
  
}


sim = 1
for (i in seq_along(rList) ){
  setwd(simDir)
  
  dataFile <- paste0('SimData-d', d, '-n', n, '-k', k, '-l', 1, '-rho', rho0,'-r',r , '-sim', sim,".RData")
  load(dataFile)
  
  labels_vraisRec[,i] = data$labelsVrais
  r = rList[i]
  setwd(resDir)
  
  for (j in seq_along(l1val)[5:length(l1val)]){
    
    if(j >= 2){
      l = lList[j]
    }
    
    
    fitFile <- paste0('FitParms-d', d,  '-n', n, '-k', k, '-l', l, '-rho', rho1, '-r',r,'-sim', sim,".RData")
    load(fitFile)
    
    erreursSigma[i,(j - 3),1] = norm(Sigma0 - fitNaif$Sigma,"F")
    
    erreursSigma[i,(j - 3),2] = norm(Sigma0 - fitUsOnline$Sigma[n,,],"F")
    
    erreursSigma[i,(j - 3),3] = norm(Sigma0 - fitUSStreaming$Sigma[n,,],"F")
    
    outliers_labelsRec[,i,(j - 3),1] = fitNaif$outliers_labels
    outliers_labelsRec[,i,(j - 3),2] = fitUsOnline$outlier_labels
    outliers_labelsRec[,i,(j - 3),3] = fitUSStreaming$outlier_labels
    
    
    
  }
  
}




for (i in seq_along(rList) ) {

  setwd(resDir)
  
  fitFile <- paste0('FitParms-d', d,  '-n', n, '-k', k, '-l', 1, '-rho', rho1, '-r',r,'-sim', sim,".RData")
  load(fitFile)
  
  erreursSigma[i,1,1] = norm(Sigma0 - fitNaif$Sigma,"F")
  print(paste0("Erreur Fit Naïf ",erreursSigma[i,1,1]))
  erreursSigma[i,1,2] = norm(Sigma0 - fitUsOnline$Sigma[n,,],"F")
  print(paste0("Erreur Fit Online ",erreursSigma[i,1,2]))
  erreursSigma[i,1,3] = norm(Sigma0 - fitUSStreaming$Sigma[n,,],"F")
  print(paste0("Erreur Fit Streaming ",erreursSigma[i,1,3]))
  
  outliers_labelsRec[,i,1,1] = fitNaif$outliers_labels
  outliers_labelsRec[,i,1,2] = fitUsOnline$outlier_labels
  outliers_labelsRec[,i,1,3] = fitUSStreaming$outlier_labels
  
}


k = 0
l = 1
erreursSigma = array(0,dim = c(length(rList),length(l1val[4:length(l1val)]),3))
outliers_labelsRec = array(0,dim = c(n,length(rList),length(l1val[4:length(l1val)]),3))
labels_vraisRec = matrix(0,n,length(rList))

sim = 1
#setwd("C:/Users/Paul/Documents/Simus/FitSim")
for (i in seq_along(rList) ){
  #setwd(simDir)
  r = rList[i]
  
  # dataFile <- paste0('SimData-d', d, '-n', n, '-k', k, '-l', l, '-rho', rho0,'-r',r , '-sim', sim,".RData")
  # load(dataFile)
  # 
  #labels_vraisRec[,i] = data$labelsVrais
  print(paste0("r =",r))
  setwd(resDir)
  
    for (j in seq_along(rho1List)){
    rho1 = rho1List[j]
    print(paste0("rho1 =",rho1))
       
    fitFile <- paste0('FitParms-d', d,  '-n', n, '-k', k, '-l', l, '-rho', rho1, '-r',r,'-sim', sim,".RData")
    load(fitFile)
    
    erreursSigma[i,j,1] = norm(Sigma0 - fitNaif$Sigma,"F")
    print(paste0("Erreur Fit Naïf ",erreursSigma[i,j,1]))
    erreursSigma[i,j,2] = norm(Sigma0 - fitUsOnline$Sigma[n,,],"F")
    print(paste0("Erreur Fit Online ",erreursSigma[i,j,2]))
    erreursSigma[i,j,3] = norm(Sigma0 - fitUSStreaming$Sigma[n,,],"F")
    print(paste0("Erreur Fit Streaming ",erreursSigma[i,j,3]))
    
    outliers_labelsRec[,i,j,1] = fitNaif$outliers_labels
    outliers_labelsRec[,i,j,2] = fitUsOnline$outlier_labels
    outliers_labelsRec[,i,j,3] = fitUSStreaming$outlier_labels
    
    
    
  }
  
}



##################################
#Plot
#################################


# Créer le plot vide avec la première courbe (KL = 0)
plot(rList, erreursSigma[,1,1], type = "l", col = "blue", lwd = 2,
     xlab = "r", ylab = "Sigma estimation error",
     ylim = range(erreursSigma[,,1], na.rm = TRUE),
     main = "Sigma estimation error for different KL (l varying) Naive Online ")

# Ajouter les autres courbes
lines(rList, erreursSigma[,2,1], col = "red", lwd = 2)
lines(rList, erreursSigma[,3,1], col = "green", lwd = 2)
lines(rList, erreursSigma[,4,1], col = "purple", lwd = 2)

# Ajouter une légende
legend("topright", legend = c("KL = 0", "KL = 1", "KL = 10", "KL = 100"),
       col = c("blue", "red", "green", "purple"), lwd = 2, bty = "n")



##########################################



